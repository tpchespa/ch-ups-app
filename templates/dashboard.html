<!DOCTYPE html>
<html>
<head><link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}"><title>UPS Full Form</title><script src="https://cdn.socket.io/4.3.2/socket.io.min.js"></script></head>
<body>
  <header>
    <div>Welcome, {{ current_user.email }}</div>
    <a href="/logout">Logout</a>
  </header>

<div class="container">
<h2>UPS Form</h2>

<form id="form">
  <div class="form-wrapper-scroll">
    <div class="form-label-row">
      <div>Contact Name</div>
      <div>Company or Name</div>
      <div>Country</div>
      <div>Address 1</div>
      <div>Address 2</div>
      <div>Address 3</div>
      <div>City</div>
      <div>State/Prov/Other</div>
      <div>Postal Code</div>
      <div>Telephone</div>
      <div>Ext</div>
      <div>Residential Ind</div>
      <div>Consignee Email</div>
      <div>Packaging Type</div>
      <div>Customs Value</div>
      <div>Weight</div>
      <div>Length</div>
      <div>Width</div>
      <div>Height</div>
      <div>Unit of Measure</div>
      <div>Description of Goods</div>
      <div>Documents of No Commercial Value</div>
      <div>GNIFC</div>
      <div>Pkg Decl Value</div>
      <div>Service</div>
      <div>Delivery Confirm</div>
      <div>Shipper Release</div>
      <div>Ret of Documents</div>
      <div>Saturday Deliver</div>
      <div>Carbon Neutral</div>
      <div>Large Package</div>
      <div>Addl handling</div>
      <div>Reference 1</div>
      <div>Reference 2</div>
      <div>Reference 3</div>
    </div>

    <div class="form-row">
      <input type="text" id="Contact_Name">
      <input type="text" id="Company_or_Name">
      <input type="text" id="Country">
      <input type="text" id="Address_1">
      <input type="text" id="Address_2">
      <input type="text" id="Address_3">
      <input type="text" id="City">
      <input type="text" id="State_Prov_Other">
      <input type="text" id="Postal_Code">
      <input type="text" id="Telephone">
      <input type="text" id="Ext">
      <input type="text" id="Residential_Ind">
      <input type="text" id="Consignee_Email">
      <input type="text" id="Packaging_Type">
      <input type="text" id="Customs_Value">
      <input type="text" id="Weight">
      <input type="text" id="Length">
      <input type="text" id="Width">
      <input type="text" id="Height">
      <input type="text" id="Unit_of_Measure">
      <input type="text" id="Description_of_Goods">
      <input type="text" id="Documents_of_No_Commercial_Value">
      <input type="text" id="GNIFC">
      <input type="text" id="Pkg_Decl_Value">
      <input type="text" id="Service">
      <input type="text" id="Delivery_Confirm">
      <input type="text" id="Shipper_Release">
      <input type="text" id="Ret_of_Documents">
      <input type="text" id="Saturday_Deliver">
      <input type="text" id="Carbon_Neutral">
      <input type="text" id="Large_Package">
      <input type="text" id="Addl_handling">
      <input type="text" id="Reference_1">
      <input type="text" id="Reference_2">
      <input type="text" id="Reference_3">
    </div>
  </div>

  <button type="button" id="toggle-advanced">Show Advanced Fields</button>

  <div id="advanced-wrapper" class="form-wrapper-scroll" style="display: none;">
    <div class="form-label-row">
      <div>QV Notif 1-Addr</div>
      <div>QV Notif 1-Ship</div>
      <div>QV Notif 1-Excp</div>
      <div>QV Notif 1-Delv</div>
      <div>QV Notif 2-Addr</div>
      <div>QV Notif 2-Ship</div>
      <div>QV Notif 2-Excp</div>
      <div>QV Notif 2-Delv</div>
      <div>QV Notif 3-Addr</div>
      <div>QV Notif 3-Ship</div>
      <div>QV Notif 3-Excp</div>
      <div>QV Notif 3-Delv</div>
      <div>QV Notif 4-Addr</div>
      <div>QV Notif 4-Ship</div>
      <div>QV Notif 4-Excp</div>
      <div>QV Notif 4-Delv</div>
      <div>QV Notif 5-Addr</div>
      <div>QV Notif 5-Ship</div>
      <div>QV Notif 5-Excp</div>
      <div>QV Notif 5-Delv</div>
      <div>QV Notif Msg</div>
      <div>QV Failure Addr</div>
      <div>UPS Premium Care</div>
      <div>ADL Location ID</div>
      <div>ADL Media Type</div>
      <div>ADL Language</div>
      <div>ADL Notification Addr</div>
      <div>ADL Failure Addr</div>
      <div>ADL COD Value</div>
      <div>ADL Deliver to Addressee</div>
      <div>ADL Shipper Media Type</div>
      <div>ADL Shipper Language</div>
      <div>ADL Shipper Notification Addr</div>
      <div>ADL Direct Delivery Only</div>
      <div>Electronic Package Release Authentication</div>
      <div>Lithium Ion Alone</div>
      <div>Lithium Ion In Equipment</div>
      <div>Lithium Ion With_Equipment</div>
      <div>Lithium Metal Alone</div>
      <div>Lithium Metal In Equipment</div>
      <div>Lithium Metal With Equipment</div>
      <div>Weekend Commercial Delivery</div>
      <div>Dry Ice Weight</div>
      <div>Merchandise Description</div>
      <div>UPS SurePost速Limited Quantity/Lithium Battery</div>
    </div>
    <div class="form-row">
      <input type="text" id="QV_Notif_1-Addr">
      <input type="text" id="QV_Notif_1-Ship">
      <input type="text" id="QV_Notif_1-Excp">
      <input type="text" id="QV_Notif_1-Delv">
      <input type="text" id="QV_Notif_2-Addr">
      <input type="text" id="QV_Notif_2-Ship">
      <input type="text" id="QV_Notif_2-Excp">
      <input type="text" id="QV_Notif_2-Delv">
      <input type="text" id="QV_Notif_3-Addr">
      <input type="text" id="QV_Notif_3-Ship">
      <input type="text" id="QV_Notif_3-Excp">
      <input type="text" id="QV_Notif_3-Delv">
      <input type="text" id="QV_Notif_4-Addr">
      <input type="text" id="QV_Notif_4-Ship">
      <input type="text" id="QV_Notif_4-Excp">
      <input type="text" id="QV_Notif_4-Delv">
      <input type="text" id="QV_Notif_5-Addr">
      <input type="text" id="QV_Notif_5-Ship">
      <input type="text" id="QV_Notif_5-Excp">
      <input type="text" id="QV_Notif_5-Delv">
      <input type="text" id="QV_Notif_Msg">
      <input type="text" id="QV_Failure_Addr">
      <input type="text" id="UPS_Premium_Care">
      <input type="text" id="ADL_Location_ID">
      <input type="text" id="ADL_Media_Type">
      <input type="text" id="ADL_Language">
      <input type="text" id="ADL_Notification_Addr">
      <input type="text" id="ADL_Failure_Addr">
      <input type="text" id="ADL_COD_Value">
      <input type="text" id="ADL_Deliver_to_Addressee">
      <input type="text" id="ADL_Shipper_Media_Type">
      <input type="text" id="ADL_Shipper_Language">
      <input type="text" id="ADL_Shipper_Notification_Addr">
      <input type="text" id="ADL_Direct_Delivery_Only">
      <input type="text" id="Electronic_Package_Release_Authentication">
      <input type="text" id="Lithium_Ion_Alone">
      <input type="text" id="Lithium_Ion_In_Equipment">
      <input type="text" id="Lithium_Ion_With_Equipment">
      <input type="text" id="Lithium_Metal_Alone">
      <input type="text" id="Lithium_Metal_In_Equipment">
      <input type="text" id="Lithium_Metal_With_Equipment">
      <input type="text" id="Weekend_Commercial_Delivery">
      <input type="text" id="Dry_Ice_Weight">
      <input type="text" id="Merchandise_Description">
      <input type="text" id="UPS_SurePost速Limited_Quantity_Lithium_Battery">
    </div>
  </div>

  <div class="form-submit">
    <button type="submit" class="submit-button">Add</button>
  </div>

</form>

<div class="form-errors-wrapper">
  <div id="form-errors" class="error-box" style="display: none;"></div>
</div>




    <h3>Live Table</h3>
    <table id="table">
      <thead>
        <tr>
          <th>Time</th><th>User</th><th>Contact</th><th>Company</th><th>Country</th><th>Actions</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <a href="/download" class="button-link">Download CSV</a>
  </div>
<script>
const socket = io();
document.getElementById("form").onsubmit = e => {
    e.preventDefault();
    let data = {};
    ["Contact Name","Company or Name","Country","Address 1","Address 2","Address 3","City","State/Prov/Other","Postal Code","Telephone","Ext","Residential Ind","Consignee Email","Packaging Type","Customs Value","Weight","Length","Width","Height","Unit of Measure","Description of Goods","Documents of No Commercial Value","GNIFC","Pkg Decl Value","Service","Delivery Confirm","Shipper Release","Ret of Documents","Saturday Deliver","Carbon Neutral","Large Package","Addl handling","Reference 1","Reference 2","Reference 3","QV Notif 1-Addr","QV Notif 1-Ship","QV Notif 1-Excp","QV Notif 1-Delv","QV Notif 2-Addr","QV Notif 2-Ship","QV Notif 2-Excp","QV Notif 2-Delv","QV Notif 3-Addr","QV Notif 3-Ship","QV Notif 3-Excp","QV Notif 3-Delv","QV Notif 4-Addr","QV Notif 4-Ship","QV Notif 4-Excp","QV Notif 4-Delv","QV Notif 5-Addr","QV Notif 5-Ship","QV Notif 5-Excp","QV Notif 5-Delv","QV Notif Msg","QV Failure Addr","UPS Premium Care","ADL Location ID","ADL Media Type","ADL Language","ADL Notification Addr","ADL Failure Addr","ADL COD Value","ADL Deliver to Addressee","ADL Shipper Media Type","ADL Shipper Language","ADL Shipper Notification Addr","ADL Direct Delivery Only","Electronic Package Release Authentication","Lithium Ion Alone","Lithium Ion In Equipment","Lithium Ion With_Equipment","Lithium Metal Alone","Lithium Metal In Equipment","Lithium Metal With Equipment","Weekend Commercial Delivery","Dry Ice Weight","Merchandise Description","UPS SurePost速Limited Quantity/Lithium Battery"].forEach(field => {
        let id = field.replace(/\s|\//g, "_");
        data[field] = document.getElementById(id).value;
    });
    socket.emit("submit_form", data);
};

socket.on('form_error', (payload) => {
  const errorBox = document.getElementById("form-errors");
  errorBox.innerText = "Please fix the following issues:\n" + payload.errors.join("\n");
  errorBox.style.display = "block";
});

socket.on("new_entry", data => {
    document.getElementById("form-errors").style.display = "none";
    const row = document.createElement("tr");
    row.setAttribute("data-id", data.id);
    row.innerHTML = `
  <td>${data.data["_submitted_by"] || "?"}</td>
  <td>${data.data["_submitted_at"]?.slice(0, 19).replace("T", " ") || "?"}</td>
  <td>${data.data["Contact Name"]}</td>
  <td>${data.data["Company or Name"]}</td>
  <td>${data.data["Country"]}</td>
  <td><button onclick="deleteEntry(${data.id})">Delete</button></td>
`;
    document.querySelector("#table tbody").appendChild(row);
});

function deleteEntry(id) {
    socket.emit("delete_entry", {id});
}

socket.on("entry_deleted", data => {
    const row = document.querySelector(`tr[data-id='${data.id}']`);
    if (row) row.remove();
});

const fieldOrder = [ "Contact Name", "Company or Name", "Country", "Address 1", "Address 2", "Address 3", "City", "State/Prov/Other",
    "Postal Code", "Telephone", "Ext", "Residential Ind", "Consignee Email", "Packaging Type", "Customs Value",
    "Weight", "Length", "Width", "Height", "Unit of Measure", "Description of Goods", "Documents of No Commercial Value",
    "GNIFC", "Pkg Decl Value", "Service", "Delivery Confirm", "Shipper Release", "Ret of Documents", "Saturday Deliver",
    "Carbon Neutral", "Large Package", "Addl handling", "Reference 1", "Reference 2", "Reference 3", "QV Notif 1-Addr",
    "QV Notif 1-Ship", "QV Notif 1-Excp", "QV Notif 1-Delv", "QV Notif 2-Addr", "QV Notif 2-Ship", "QV Notif 2-Excp",
    "QV Notif 2-Delv", "QV Notif 3-Addr", "QV Notif 3-Ship", "QV Notif 3-Excp", "QV Notif 3-Delv", "QV Notif 4-Addr",
    "QV Notif 4-Ship", "QV Notif 4-Excp", "QV Notif 4-Delv", "QV Notif 5-Addr", "QV Notif 5-Ship", "QV Notif 5-Excp",
    "QV Notif 5-Delv", "QV Notif Msg", "QV Failure Addr", "UPS Premium Care", "ADL Location ID", "ADL Media Type",
    "ADL Language", "ADL Notification Addr", "ADL Failure Addr", "ADL COD Value", "ADL Deliver to Addressee",
    "ADL Shipper Media Type", "ADL Shipper Language", "ADL Shipper Notification Addr", "ADL Direct Delivery Only",
    "Electronic Package Release Authentication", "Lithium Ion Alone", "Lithium Ion In Equipment",
    "Lithium Ion With_Equipment", "Lithium Metal Alone", "Lithium Metal In Equipment",
    "Lithium Metal With Equipment", "Weekend Commercial Delivery", "Dry Ice Weight", "Merchandise Description",
    "UPS SurePost速Limited Quantity/Lithium Battery" ];

const firstFieldId = fieldOrder[0].replace(/\s|\//g, "_");
const firstInput = document.getElementById(firstFieldId);

firstInput.addEventListener('paste', function (e) {
  e.preventDefault();
  const clipboard = e.clipboardData.getData('text/plain');
  const values = clipboard.split('\t');

  fieldOrder.forEach((field, i) => {
    const id = field.replace(/\s|\//g, "_");
    const input = document.getElementById(id);
    if (input && values[i] !== undefined) {
      input.value = values[i];
    }
  });
});

document.getElementById("form").onsubmit = function(e) {
  e.preventDefault();
  const data = {};

  fieldOrder.forEach(field => {
    const id = field.replace(/\s|\//g, "_");
    const input = document.getElementById(id);
    if (input) data[field] = input.value;
  });

  socket.emit("submit_form", data);
};



document.getElementById("toggle-advanced").addEventListener("click", () => {
  const wrapper = document.getElementById("advanced-wrapper");
  const toggle = document.getElementById("toggle-advanced");

  const visible = wrapper.style.display === "block";
  wrapper.style.display = visible ? "none" : "block";
  toggle.textContent = visible ? "Show Advanced Fields" : "Hide Advanced Fields";
});

function renderRow(entry) {
  const row = document.createElement("tr");
  row.setAttribute("data-id", entry.id);
  row.innerHTML = `
    <td>${entry.data["_submitted_by"] || "?"}</td>
    <td>${entry.data["_submitted_at"]?.slice(0, 19).replace("T", " ") || "?"}</td>
    <td>${entry.data["Contact Name"]}</td>
    <td>${entry.data["Company or Name"]}</td>
    <td>${entry.data["Country"]}</td>
    <td><button onclick="deleteEntry(${entry.id})">Delete</button></td>
  `;
  document.querySelector("#table tbody").appendChild(row);
}

{% for entry in entries %}
  renderRow({ id: {{ entry.id }}, data: {{ entry.data|tojson }} });
{% endfor %}



</script>
</body>
</html>
